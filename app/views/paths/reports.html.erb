

<%= panel_for title: 'Reports', size: 12 do %>
    <div class="panel-body" style="text-align: center">
        <h1>Altitude par point du trajet</h1>
        <canvas id="altitude" width="600" height="400"></canvas>
    </div>
    <div class="panel-footer text-right">
      <%= back_to paths_path %>
    </div>
<% end %>


<%= content_for :scripts do %>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">

        var pointsLabels = [];
        var points = [];
        var elevations = [];
        var elevationService = new google.maps.ElevationService();

        loadPath();

        function loadPath() {
            $.getJSON("http://localhost:3000/paths/1.json", function (data) {
                getAddress(data.clients);
                getAddress(data.potential_clients);
            });
            getElevation(points);
        }

        function getAddress(data) {
            $.each(data, function (key, value) {
                $.getJSON("http://localhost:3000/clients/" + value.id, function (data) {
                    pointsLabels.push(data.name);
                    points.push(new google.maps.LatLng(data.address.longitude, data.address.latitude));
                });
            });
        }

        function getElevation(points) {

            var requete = {
                'locations': points
            }

            elevationService.getElevationForLocations(requete, function(results, status) {
                $.each(results, function(index, value) {
                    elevations.push(value.elevation);
                });
            });
            createChart(pointsLabels, elevations);
        }

        function debugging() {
            for (var i = 0; i < points.length; i++) {
                console.log(":: " + pointsLabels[i] + " :: " + points[i] + " :: " + elevations[i]);
            }
        }

        function createChart(labels, elevation) {
            points = {
                labels : labels,
                datasets : [
                    {
                        fillColor : "rgba(172,194,132,0.4)",
                        strokeColor : "#ACC26D",
                        pointColor : "#fff",
                        pointStrokeColor : "#9DB86D",
                        data : elevation
                    }
                ]
            }
            var altitude = document.getElementById('altitude').getContext('2d');
            new Chart(altitude).Line(points);
        }
    </script>
<% end %>
